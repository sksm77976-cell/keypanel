<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CH Key Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:'Inter',sans-serif;
background:#0f172a;
color:white;
overflow-x:hidden;
}

#particles{
position:fixed;
width:100%;
height:100%;
z-index:-1;
background:linear-gradient(135deg,#0f172a,#1e293b);
}

.container{
width:95%;
max-width:1200px;
margin:auto;
padding:20px;
}

h1{
font-size:28px;
font-weight:800;
}

.stats{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
gap:15px;
margin:20px 0;
}

.card{
background:#1e293b;
padding:15px;
border-radius:15px;
transition:0.3s;
}

.card:hover{
transform:translateY(-5px);
box-shadow:0 0 20px rgba(0,255,200,0.2);
}

.stat-number{
font-size:22px;
font-weight:800;
margin-top:5px;
}

.create-box{
background:#1e293b;
padding:15px;
border-radius:15px;
margin-bottom:20px;
}

input,select{
padding:8px;
border-radius:8px;
border:none;
margin:5px 0;
width:100%;
max-width:200px;
}

button{
padding:8px 14px;
border:none;
border-radius:8px;
cursor:pointer;
transition:0.2s;
font-weight:600;
}

button:hover{
transform:scale(1.05);
}

.primary{background:#3b82f6;color:white}
.danger{background:#ef4444;color:white}
.success{background:#22c55e;color:white}
.warning{background:#facc15;color:black}

.table{
background:#1e293b;
padding:15px;
border-radius:15px;
overflow-x:auto;
}

table{
width:100%;
border-collapse:collapse;
min-width:700px;
}

th,td{
padding:10px;
text-align:left;
}

tr{
border-bottom:1px solid rgba(255,255,255,0.05);
}

.action-btn{
cursor:pointer;
margin-right:6px;
transition:0.2s;
}

.action-btn:hover{
transform:scale(1.2);
}
</style>
</head>
<body>

<canvas id="particles"></canvas>

<div class="container">

<h1>üîë CH Key Professional Dashboard</h1>

<div class="stats">
<div class="card">Total<div id="total" class="stat-number">0</div></div>
<div class="card">Activas<div id="active" class="stat-number">0</div></div>
<div class="card">Baneadas<div id="banned" class="stat-number">0</div></div>
<div class="card">Expiradas<div id="expired" class="stat-number">0</div></div>
</div>

<div class="create-box">
<h3>‚ûï Crear Nueva Key</h3>
<input id="timeValue" placeholder="Cantidad">
<select id="timeType">
<option value="minutes">Minutos</option>
<option value="hours">Horas</option>
<option value="days">D√≠as</option>
</select>
<br>
<button class="primary" onclick="createKey()">Crear</button>
</div>

<div class="table">
<table>
<thead>
<tr>
<th>Key</th>
<th>Tiempo Restante</th>
<th>Estado</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="keyTable"></tbody>
</table>
</div>

</div>

<script>
const API="https://keysystem-b6950-default-rtdb.firebaseio.com/keys";
let cacheData={};

function generateKey(){
let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
let result="CH";
for(let i=0;i<4;i++){
result+=chars.charAt(Math.floor(Math.random()*chars.length));
}
return result;
}

function convertToMs(v,t){
if(t==="minutes") return v*60000;
if(t==="hours") return v*3600000;
if(t==="days") return v*86400000;
}

function formatTime(ms){
if(ms<=0) return "Expirada";
let s=Math.floor(ms/1000);
let m=Math.floor(s/60);
let h=Math.floor(m/60);
let d=Math.floor(h/24);
return d+"d "+(h%24)+"h "+(m%60)+"m "+(s%60)+"s";
}

function createKey(){
let value=parseInt(document.getElementById("timeValue").value);
let type=document.getElementById("timeType").value;
if(!value) return;

let key=generateKey();
let expire=Date.now()+convertToMs(value,type);

fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify({expire:expire,banned:false})
}).then(loadKeys);
}

function loadKeys(){
fetch(API+".json")
.then(r=>r.json())
.then(data=>{
cacheData=data||{};
renderTable();
});
}

function renderTable(){
let total=0,active=0,banned=0,expired=0;
let table=document.getElementById("keyTable");
table.innerHTML="";

Object.keys(cacheData).forEach(k=>{
total++;
let data=cacheData[k];
let remaining=data.expire-Date.now();
let estado="Activa";

if(data.banned){estado="Baneada";banned++}
else if(remaining<=0){estado="Expirada";expired++}
else active++;

let row=document.createElement("tr");

row.innerHTML=`
<td>${k} <span class="action-btn" onclick="copyKey('${k}')">üìã</span></td>
<td id="time_${k}">${formatTime(remaining)}</td>
<td>${estado}</td>
<td>
<span class="action-btn" onclick="toggleBan('${k}')">${data.banned?"üü¢":"üö´"}</span>
<span class="action-btn" onclick="addTime('${k}',5)">‚ûï5m</span>
<span class="action-btn" onclick="removeTime('${k}',5)">‚ûñ5m</span>
<span class="action-btn" onclick="deleteKey('${k}')">üóëÔ∏è</span>
</td>
`;

table.appendChild(row);
});

document.getElementById("total").innerText=total;
document.getElementById("active").innerText=active;
document.getElementById("banned").innerText=banned;
document.getElementById("expired").innerText=expired;
}

function updateTimers(){
Object.keys(cacheData).forEach(k=>{
let el=document.getElementById("time_"+k);
if(!el) return;
let remaining=cacheData[k].expire-Date.now();
el.innerText=formatTime(remaining);
});
}

function toggleBan(key){
cacheData[key].banned=!cacheData[key].banned;
fetch(API+"/"+key+"/banned.json",{method:"PUT",body:JSON.stringify(cacheData[key].banned)});
renderTable();
}

function addTime(key,min){
cacheData[key].expire+=min*60000;
fetch(API+"/"+key+"/expire.json",{method:"PUT",body:JSON.stringify(cacheData[key].expire)});
renderTable();
}

function removeTime(key,min){
cacheData[key].expire-=min*60000;
fetch(API+"/"+key+"/expire.json",{method:"PUT",body:JSON.stringify(cacheData[key].expire)});
renderTable();
}

function deleteKey(key){
fetch(API+"/"+key+".json",{method:"DELETE"}).then(loadKeys);
}

function copyKey(key){
navigator.clipboard.writeText(key);
}

setInterval(updateTimers,1000);
setInterval(loadKeys,5000);
loadKeys();

/* PARTICULAS */
const canvas=document.getElementById("particles");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

let particles=[];
for(let i=0;i<80;i++){
particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2});
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="rgba(0,255,200,0.3)";
particles.forEach(p=>{
ctx.beginPath();
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
p.y+=0.3;
if(p.y>canvas.height) p.y=0;
});
requestAnimationFrame(animate);
}
animate();

</script>

</body>
</html>
