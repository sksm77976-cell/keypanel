<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CH Key System</title>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
color:white;
overflow-x:hidden;
}

.login{
position:fixed;
inset:0;
display:flex;
justify-content:center;
align-items:center;
background:#000000ee;
z-index:10;
}

.login-box{
background:#111;
padding:30px;
border-radius:12px;
text-align:center;
box-shadow:0 0 20px #00e1ff;
animation:fadeIn .5s;
}

input,select{
padding:6px;
border-radius:6px;
border:none;
margin:4px;
}

button{
padding:6px 12px;
border:none;
border-radius:6px;
cursor:pointer;
background:#00c3ff;
color:white;
font-weight:bold;
transition:.2s;
}

button:hover{
transform:scale(1.05);
background:#00e1ff;
}

table{
width:100%;
border-collapse:collapse;
margin-top:20px;
}

th,td{
padding:8px;
text-align:center;
}

tr{
background:#111;
transition:.2s;
}

tr:hover{
background:#1b1b1b;
}

.action{
cursor:pointer;
font-size:18px;
margin:0 4px;
transition:.2s;
}

.action:hover{
transform:scale(1.2);
}

.status-active{color:#00ff88;}
.status-expired{color:#ff5555;}
.status-banned{color:#ff0000;}

.container{
padding:20px;
max-width:1100px;
margin:auto;
}

@keyframes fadeIn{
from{opacity:0;transform:scale(.8);}
to{opacity:1;transform:scale(1);}
}

@media(max-width:768px){
table{font-size:12px;}
}
</style>
</head>

<body>

<div class="login" id="login">
<div class="login-box">
<h2>üîê Enter Access Code</h2>
<input type="password" id="accessCode">
<br><br>
<button onclick="checkLogin()">ENTER</button>
</div>
</div>

<div class="container" id="panel" style="display:none;">
<h1>üîë CH Key System</h1>

<button onclick="createKey()">‚ûï Create Key</button>

<table>
<thead>
<tr>
<th>Key</th>
<th>Status</th>
<th>Time Left</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="keyTable"></tbody>
</table>

</div>

<script>
const API="https://keysystem-b6950-default-rtdb.firebaseio.com/keys";
const ACCESS="110808";
let cache={};

function checkLogin(){
let val=document.getElementById("accessCode").value;
if(val===ACCESS){
document.getElementById("login").style.display="none";
document.getElementById("panel").style.display="block";
loadKeys();
}else alert("Wrong Code");
}

function randomKey(){
return "CH"+Math.floor(1000+Math.random()*9000);
}

async function createKey(){
let key=randomKey();

await fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify({
duration:3600000,
expire:0,
started:false,
banned:false,
inUse:null
})
});

loadKeys();
}

function convertToMs(value,type){
if(type==="minutes") return value*60000;
if(type==="hours") return value*3600000;
if(type==="days") return value*86400000;
}

async function addTime(key){
let val=parseInt(document.getElementById("add_"+key).value);
let type=document.getElementById("type_"+key).value;
if(!val||val<=0) return;

let res=await fetch(API+"/"+key+".json");
let data=await res.json();

let ms=convertToMs(val,type);
let now=Date.now();

if(!data.expire||data.expire<now){
data.expire=now+ms;
}else{
data.expire+=ms;
}

await fetch(API+"/"+key+"/expire.json",{
method:"PUT",
body:JSON.stringify(data.expire)
});

loadKeys();
}

async function removeTime(key){
let val=parseInt(document.getElementById("add_"+key).value);
let type=document.getElementById("type_"+key).value;
if(!val||val<=0) return;

let res=await fetch(API+"/"+key+".json");
let data=await res.json();

let ms=convertToMs(val,type);
data.expire-=ms;

await fetch(API+"/"+key+"/expire.json",{
method:"PUT",
body:JSON.stringify(data.expire)
});

loadKeys();
}

async function toggleBan(key){
let res=await fetch(API+"/"+key+"/banned.json");
let val=await res.json();
await fetch(API+"/"+key+"/banned.json",{
method:"PUT",
body:JSON.stringify(!val)
});
loadKeys();
}

async function deleteKey(key){
if(!confirm("Delete key?"))return;
await fetch(API+"/"+key+".json",{method:"DELETE"});
loadKeys();
}

function copyKey(key){
navigator.clipboard.writeText(key);
alert("Copied: "+key);
}

function formatTime(ms){
let now=Date.now();
let diff=ms-now;
if(diff<=0)return "Expired";
let s=Math.floor(diff/1000);
let h=Math.floor(s/3600);
let m=Math.floor((s%3600)/60);
let sec=s%60;
return h+"h "+m+"m "+sec+"s";
}

async function loadKeys(){
let res=await fetch(API+".json");
let data=await res.json();
cache=data||{};
render();
}

function render(){
let table=document.getElementById("keyTable");
table.innerHTML="";

for(let k in cache){
let data=cache[k];
let now=Date.now();

let status="Active";
let classStatus="status-active";

if(data.banned){
status="Banned";
classStatus="status-banned";
}else if(!data.expire||data.expire<now){
status="Expired";
classStatus="status-expired";
}

table.innerHTML+=`
<tr>
<td>${k}</td>
<td class="${classStatus}">${status}</td>
<td>${formatTime(data.expire)}</td>
<td>
<span class="action" onclick="copyKey('${k}')">üìã</span>
<span class="action" onclick="toggleBan('${k}')">${data.banned?"üü¢":"üö´"}</span>
<span class="action" onclick="deleteKey('${k}')">üóëÔ∏è</span>
<br>
<input id="add_${k}" placeholder="Time">
<select id="type_${k}">
<option value="minutes">Min</option>
<option value="hours">Hours</option>
<option value="days">Days</option>
</select>
<span class="action" onclick="addTime('${k}')">‚ûï</span>
<span class="action" onclick="removeTime('${k}')">‚ûñ</span>
</td>
</tr>
`;
}

setTimeout(loadKeys,1000);
}
</script>

</body>
</html>
