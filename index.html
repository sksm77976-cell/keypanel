<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CH Key Professional Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box}
body{
margin:0;
font-family:'Inter',sans-serif;
background:#0f172a;
color:white;
overflow-x:hidden;
}

/* LOCK SCREEN */
#lockScreen{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:linear-gradient(135deg,#0f172a,#1e293b);
display:flex;
justify-content:center;
align-items:center;
flex-direction:column;
z-index:9999;
}

#lockScreen input{
padding:12px;
border-radius:10px;
border:none;
margin-bottom:10px;
text-align:center;
}

#lockScreen button{
padding:10px 20px;
border:none;
border-radius:10px;
background:#3b82f6;
color:white;
cursor:pointer;
}

/* PARTICLES */
#particles{
position:fixed;
width:100%;
height:100%;
z-index:-1;
background:linear-gradient(135deg,#0f172a,#1e293b);
}

.container{
width:95%;
max-width:1200px;
margin:auto;
padding:20px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:15px;
margin-bottom:15px;
}

table{
width:100%;
border-collapse:collapse;
min-width:900px;
}

th,td{
padding:10px;
text-align:left;
}

tr{
border-bottom:1px solid rgba(255,255,255,0.05);
}

.action{
cursor:pointer;
margin-right:8px;
}
</style>
</head>
<body>

<div id="lockScreen">
<h2>ğŸ”’ Acceso Restringido</h2>
<input id="accessCode" type="password" placeholder="CÃ³digo">
<button onclick="checkAccess()">Entrar</button>
<p id="errorMsg" style="color:red;"></p>
</div>

<canvas id="particles"></canvas>

<div class="container">

<h1>ğŸ”‘ CH Key Dashboard</h1>

<div class="card">
<h3>Crear Nueva Key</h3>
<input id="timeValue" placeholder="Cantidad">
<select id="timeType">
<option value="minutes">Minutos</option>
<option value="hours">Horas</option>
<option value="days">DÃ­as</option>
</select>
<button onclick="createKey()">Crear</button>
</div>

<div class="card">
<table>
<thead>
<tr>
<th>Key</th>
<th>DuraciÃ³n</th>
<th>Tiempo Restante</th>
<th>Estado</th>
<th>Uso</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="keyTable"></tbody>
</table>
</div>

</div>

<script>
const API="https://keysystem-b6950-default-rtdb.firebaseio.com/keys";
let cache={};

function checkAccess(){
if(document.getElementById("accessCode").value==="110808"){
document.getElementById("lockScreen").style.display="none";
}
else{
document.getElementById("errorMsg").innerText="CÃ³digo incorrecto";
}
}

function generateKey(){
let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
let k="CH";
for(let i=0;i<4;i++){
k+=chars.charAt(Math.floor(Math.random()*chars.length));
}
return k;
}

function convertToMs(v,t){
if(t==="minutes") return v*60000;
if(t==="hours") return v*3600000;
if(t==="days") return v*86400000;
}

function format(ms){
if(!ms) return "No activada";
if(ms<=0) return "Expirada";
let s=Math.floor(ms/1000);
let m=Math.floor(s/60);
let h=Math.floor(m/60);
let d=Math.floor(h/24);
return d+"d "+(h%24)+"h "+(m%60)+"m "+(s%60)+"s";
}

function createKey(){
let val=parseInt(document.getElementById("timeValue").value);
let type=document.getElementById("timeType").value;
if(!val) return;

let key=generateKey();
let duration=convertToMs(val,type);

fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify({
duration:duration,
expire:null,
banned:false,
inUse:false,
user:null
})
}).then(load);
}

function load(){
fetch(API+".json")
.then(r=>r.json())
.then(data=>{
cache=data||{};
render();
});
}

function render(){
let table=document.getElementById("keyTable");
table.innerHTML="";

Object.keys(cache).forEach(k=>{
let d=cache[k];
let remaining=d.expire?d.expire-Date.now():null;

let row=document.createElement("tr");

row.innerHTML=`
<td>${k}</td>
<td>${Math.floor(d.duration/60000)} min</td>
<td id="time_${k}">${format(remaining)}</td>
<td>${d.banned?"ğŸš« Baneada":"Activa"}</td>
<td>${d.inUse?"ğŸŸ¢ En uso":"Libre"}</td>
<td>
<span class="action" onclick="copyKey('${k}')">ğŸ“‹</span>
<span class="action" onclick="toggleBan('${k}')">${d.banned?"ğŸŸ¢":"ğŸš«"}</span>
<span class="action" onclick="releaseKey('${k}')">ğŸ”“</span>
<span class="action" onclick="deleteKey('${k}')">ğŸ—‘ï¸</span>
</td>
`;

table.appendChild(row);
});
}

function updateTimers(){
Object.keys(cache).forEach(k=>{
let d=cache[k];
if(!d.expire) return;
let el=document.getElementById("time_"+k);
if(!el) return;
let remaining=d.expire-Date.now();
el.innerText=format(remaining);
});
}

function toggleBan(key){
cache[key].banned=!cache[key].banned;
fetch(API+"/"+key+"/banned.json",{method:"PUT",body:JSON.stringify(cache[key].banned)});
render();
}

function releaseKey(key){
fetch(API+"/"+key+".json",{
method:"PATCH",
body:JSON.stringify({
inUse:false,
user:null
})
}).then(load);
}

function deleteKey(key){
fetch(API+"/"+key+".json",{method:"DELETE"}).then(load);
}

function copyKey(k){
navigator.clipboard.writeText(k);
}

setInterval(updateTimers,1000);
setInterval(load,5000);
load();

/* PARTICLES */
const canvas=document.getElementById("particles");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;
let particles=[];
for(let i=0;i<70;i++){
particles.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,r:Math.random()*2});
}
function anim(){
ctx.clearRect(0,0,canvas.width,canvas.height);
ctx.fillStyle="rgba(0,255,200,0.3)";
particles.forEach(p=>{
ctx.beginPath();
ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
ctx.fill();
p.y+=0.3;
if(p.y>canvas.height)p.y=0;
});
requestAnimationFrame(anim);
}
anim();
</script>

</body>
</html>
