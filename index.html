<!DOCTYPE html>
<html>
<head>
<title>CH Key Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<style>

body{
margin:0;
font-family:'Inter',sans-serif;
background:linear-gradient(135deg,#0f172a,#1e293b);
color:white;
}

.container{
width:95%;
max-width:1200px;
margin:auto;
padding:20px;
}

h1{
font-size:32px;
font-weight:800;
margin-bottom:5px;
}

.subtitle{
opacity:0.7;
margin-bottom:30px;
}

.stats{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
gap:20px;
margin-bottom:30px;
}

.card{
background:#1e293b;
padding:20px;
border-radius:16px;
box-shadow:0 0 20px rgba(0,0,0,0.3);
}

.stat-number{
font-size:30px;
font-weight:800;
margin-top:10px;
}

.green{color:#22c55e;}
.red{color:#ef4444;}
.yellow{color:#facc15;}

.create-box{
background:#1e293b;
padding:20px;
border-radius:16px;
margin-bottom:30px;
}

input,select{
padding:10px;
border-radius:10px;
border:none;
margin:5px 0;
}

button{
padding:10px 20px;
border:none;
border-radius:10px;
cursor:pointer;
font-weight:600;
}

.btn-primary{
background:#3b82f6;
color:white;
}

.btn-primary:hover{
background:#2563eb;
}

.table{
background:#1e293b;
border-radius:16px;
padding:20px;
}

table{
width:100%;
border-collapse:collapse;
}

th,td{
padding:12px;
text-align:left;
}

th{
opacity:0.6;
font-weight:600;
}

tr{
border-bottom:1px solid rgba(255,255,255,0.05);
}

.copy{
cursor:pointer;
margin-left:10px;
}

.delete{
cursor:pointer;
color:#ef4444;
}

</style>
</head>
<body>

<div class="container">

<h1>üîë CH Key Generator Hub</h1>
<div class="subtitle">Gestor profesional de llaves con API conectada</div>

<div class="stats">
<div class="card">
Total de Keys
<div id="total" class="stat-number">0</div>
</div>

<div class="card">
Keys Activas
<div id="active" class="stat-number green">0</div>
</div>

<div class="card">
Keys Baneadas
<div id="banned" class="stat-number red">0</div>
</div>

<div class="card">
Keys Expiradas
<div id="expired" class="stat-number yellow">0</div>
</div>
</div>

<div class="create-box">
<h3>‚ûï Crear Nueva Key</h3>
<input id="timeValue" placeholder="Cantidad">
<select id="timeType">
<option value="minutes">Minutos</option>
<option value="hours">Horas</option>
<option value="days">D√≠as</option>
</select>
<br>
<button class="btn-primary" onclick="createKey()">Crear Key</button>
</div>

<div class="table">
<h3>üìã Todas las Keys</h3>
<table>
<thead>
<tr>
<th>Key</th>
<th>Tiempo Restante</th>
<th>Estado</th>
<th>Creada</th>
<th>Acciones</th>
</tr>
</thead>
<tbody id="keyTable"></tbody>
</table>
</div>

</div>

<script>

const API="https://keysystem-b6950-default-rtdb.firebaseio.com/keys";

function generateKey(){
let chars="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
let result="CH";
for(let i=0;i<4;i++){
result+=chars.charAt(Math.floor(Math.random()*chars.length));
}
return result;
}

function convertToMs(v,t){
if(t==="minutes") return v*60000;
if(t==="hours") return v*3600000;
if(t==="days") return v*86400000;
}

function formatTime(ms){
let s=Math.floor(ms/1000);
if(s<=0) return "Expirada";
let m=Math.floor(s/60);
let h=Math.floor(m/60);
let d=Math.floor(h/24);
return d+"d "+(h%24)+"h "+(m%60)+"m";
}

function createKey(){
let value=parseInt(document.getElementById("timeValue").value);
let type=document.getElementById("timeType").value;
if(!value) return;

let key=generateKey();
let expire=Date.now()+convertToMs(value,type);

fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify({
expire:expire,
banned:false,
created:Date.now()
})
}).then(loadKeys);
}

function loadKeys(){
fetch(API+".json")
.then(r=>r.json())
.then(data=>{

let total=0,active=0,banned=0,expired=0;

let table=document.getElementById("keyTable");
table.innerHTML="";

if(!data) return;

Object.keys(data).forEach(k=>{
total++;

let remaining=data[k].expire-Date.now();
let estado="Activa";

if(data[k].banned){
estado="Baneada";
banned++;
}
else if(remaining<=0){
estado="Expirada";
expired++;
}
else{
active++;
}

let row=document.createElement("tr");

row.innerHTML=`
<td>${k} <span class="copy" onclick="copyKey('${k}')">üìã</span></td>
<td>${formatTime(remaining)}</td>
<td>${estado}</td>
<td>${new Date(data[k].created).toLocaleDateString()}</td>
<td><span class="delete" onclick="deleteKey('${k}')">üóëÔ∏è</span></td>
`;

table.appendChild(row);
});

document.getElementById("total").innerText=total;
document.getElementById("active").innerText=active;
document.getElementById("banned").innerText=banned;
document.getElementById("expired").innerText=expired;

});
}

function copyKey(key){
navigator.clipboard.writeText(key);
}

function deleteKey(key){
fetch(API+"/"+key+".json",{method:"DELETE"}).then(loadKeys);
}

setInterval(loadKeys,3000);
loadKeys();

</script>

</body>
</html>
