<!DOCTYPE html>
<html>
<head>
<title>ChristianScript Key Panel</title>
<style>
body{
background:#0f0f0f;
color:white;
font-family:sans-serif;
text-align:center
}
button{
padding:8px;
margin:4px;
background:#00ff88;
border:none;
cursor:pointer;
border-radius:6px;
font-weight:bold;
}
input, select{
padding:6px;
margin:4px;
border-radius:6px;
border:none;
}
.keyBox{
background:#1a1a1a;
margin:15px;
padding:15px;
border-radius:12px;
}
</style>
</head>
<body>

<h1>ChristianScript Key Generator</h1>

<h3>Crear Nueva Key</h3>
<input id="timeValue" placeholder="Cantidad">
<select id="timeType">
<option value="minutes">Minutos</option>
<option value="hours">Horas</option>
<option value="days">Días</option>
</select>
<button onclick="createKey()">Crear Key</button>

<h2>Keys Generadas</h2>
<div id="keys"></div>

<script>

const API = "https://keysystem-b6950-default-rtdb.firebaseio.com/keys";

function randomPart(){
return Math.random().toString(36).substring(2,7).toUpperCase();
}

function generateKey(){
return "ChristianScript-" + randomPart() + "-" + randomPart();
}

function convertToMs(value,type){
if(type==="minutes") return value*60*1000;
if(type==="hours") return value*60*60*1000;
if(type==="days") return value*24*60*60*1000;
}

function formatTime(ms){
let totalSeconds = Math.floor(ms/1000);
if(totalSeconds <= 0) return "Expirada";

let days = Math.floor(totalSeconds / 86400);
let hours = Math.floor((totalSeconds % 86400)/3600);
let minutes = Math.floor((totalSeconds % 3600)/60);
let seconds = totalSeconds % 60;

return days+"d "+hours+"h "+minutes+"m "+seconds+"s";
}

function createKey(){
const value=parseInt(document.getElementById("timeValue").value);
const type=document.getElementById("timeType").value;

if(!value) return alert("Pon tiempo válido");

const key=generateKey();
const expire=Date.now()+convertToMs(value,type);

fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify({
expire:expire,
banned:false,
created:Date.now()
})
}).then(loadKeys);
}

function loadKeys(){
fetch(API+".json")
.then(res=>res.json())
.then(data=>{

const box=document.getElementById("keys");
box.innerHTML="";

if(!data){
box.innerHTML="<p>No hay keys creadas.</p>";
return;
}

Object.keys(data).forEach(k=>{

let remaining=data[k].expire-Date.now();

const div=document.createElement("div");
div.className="keyBox";

div.innerHTML=`
<b>${k}</b><br>
Creada: ${new Date(data[k].created).toLocaleString()}<br>
Expira: ${new Date(data[k].expire).toLocaleString()}<br>
Tiempo restante: ${formatTime(remaining)}<br>
Estado: ${data[k].banned ? "BANEADA" : "ACTIVA"}<br><br>

<input id="add_${k}" placeholder="Agregar tiempo">
<select id="type_${k}">
<option value="minutes">Min</option>
<option value="hours">Horas</option>
<option value="days">Días</option>
</select>

<button onclick="addTime('${k}')">Agregar Tiempo</button>
<button onclick="toggleBan('${k}', ${data[k].banned})">
${data[k].banned ? "Desbanear" : "Banear"}
</button>
<button onclick="deleteKey('${k}')">Borrar</button>
`;

box.appendChild(div);
});

});
}

function addTime(key){
const value=parseInt(document.getElementById("add_"+key).value);
const type=document.getElementById("type_"+key).value;

if(!value) return alert("Pon tiempo válido");

fetch(API+"/"+key+".json")
.then(r=>r.json())
.then(data=>{
data.expire+=convertToMs(value,type);

fetch(API+"/"+key+".json",{
method:"PUT",
body:JSON.stringify(data)
}).then(loadKeys);
});
}

function toggleBan(key,current){
fetch(API+"/"+key+"/banned.json",{
method:"PUT",
body:JSON.stringify(!current)
}).then(loadKeys);
}

function deleteKey(key){
fetch(API+"/"+key+".json",{
method:"DELETE"
}).then(loadKeys);
}

loadKeys();
setInterval(loadKeys,3000);

</script>

</body>
</html>
